<% layout('layout') -%>


    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <link rel="stylesheet" href="css/styleGraph.css">


    <div class="container">
        <div class="" style="padding-top:50px">
            <!-- TODO load data from list -->
            <select name="sources" id="sources" class="custom-select sources" placeholder="Choose Node ID" onclick="action()">
                <option value="20">Node 20</option>
                <option value="21">Node 21</option>
                <option value="4">Node 4</option>
            </select>
            <button class="btn btn-success" style="width: 100%; height: 50px;" onclick="action()">Ok</button>
        </div>
        <div id="chart" style="min-width: 310px; width:80% ; float: left ; height: 400px; margin: 50px auto"></div>

    </div>


    <script src="js/Graph.js"></script>
    <script type="text/javascript">
        function action() {
            var e = document.getElementById("sources");
            var strUser = e.options[e.selectedIndex].value;
            var myVariable;
            var count;
            var co = [];
            var dust = [];
            var gas = [];
            var temp = [];
            var xaxis = [];
            $.ajax({
                type: "GET",
                url: "http://localhost:8888/getdata?id=" + strUser, // TODO : fix localhost url
                dataType: "json",
                success: function(data) {
                    myVariable = data;
                    count = Object.keys(myVariable).length;
                    // console.log(count);
                    console.log(myVariable[0].data.co);
                    for (var i = 0; i < count; i++) {
                        co.push(Number(myVariable[i].data.co));
                        dust.push(Number(myVariable[i].data.dust));
                        temp.push(Number(myVariable[i].data.temp));
                        gas.push(Number(myVariable[i].data.gas));
                        xaxis.push(Number(i + 1));
                    }
                    drowchart();
                }
            });

            function drowchart() {
                // alert(xaxis);
                $(function() {

                    $('#chart').highcharts({
                        title: {
                            text: 'TEST',
                            x: -20 //center
                        },
                        subtitle: {
                            text: '',
                            x: -20
                        },
                        xAxis: {
                            categories: xaxis
                        },
                        yAxis: {
                            title: {
                                text: 'Temperature (°C)'
                            },
                            plotLines: [{
                                value: 0,
                                width: 1,
                                color: '#808080'
                            }]
                        },
                        tooltip: {
                            valueSuffix: '°C'
                        },
                        legend: {
                            layout: 'vertical',
                            align: 'right',
                            verticalAlign: 'middle',
                            borderWidth: 0
                        },
                        series: [{
                            name: 'CO',
                            data: co
                        }, {
                            name: 'TEMP',
                            data: temp
                        }, {
                            name: 'DUST',
                            data: dust
                        }, {
                            name: 'GAS',
                            data: gas
                        }]
                    });
                });
            }
        }
    </script>
